<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle de Sorvetes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: Arial, sans-serif;
    background: #f2f2f7;
    padding: 12px;
    max-width: 480px;
    margin: auto;
}
h1 {
    text-align: center;
    font-size: 26px;
    font-weight: 900;
}
.cat-btn {
    width: 100%;
    background: #007aff;
    color: white;
    padding: 12px;
    font-size: 17px;
    border: none;
    border-radius: 12px;
    margin-top: 12px;
    font-weight: 700;
}
.categoria {
    display: none;
    background: #fff;
    padding: 4px;
    border-radius: 10px;
}
.item {
    background: #fff;
    padding: 8px;
    margin: 6px 0;
    border-radius: 12px;
}
.item.zero {
    background: #ff4d4d !important;
    color: white;
}
.item.card {
    display: flex;
    gap: 10px;
}
.nome { font-weight: 800; }
.valor { color: #007aff; font-weight: 700; }
.item.zero .valor { color: #fff; }
.restante { font-weight: 800; }

.painel {
    background: #f1f1f1;
    padding: 8px;
    border-radius: 10px;
    min-width: 150px;
}
.controls span,
.numero {
    color: #000 !important;
    font-weight: 800;
}
.btn {
    width: 28px;
    height: 28px;
    font-weight: 800;
}
#totalVendas {
    margin-top: 14px;
    padding: 14px;
    background: #e6fff0;
    border-radius: 12px;
    font-weight: 800;
    text-align: center;
}
</style>

<script>
let precoPorCategoria = {
    "MAGNUM": null,
    "CORNETTO": null,
    "OS FAVORITOS": null,
    "FRUTARE": 10,
    "FRUTILLY": 7.5,
    "HARRY POTTER": null
};

let precosLancamentos = {
    "Clássico":20,"Branco":20,"Avelã":20,"Amêndoas":20,
    "Cookies & Cream":20,"Menos Açúcar":20,"Pistache":21,
    "Choco Mix":13,"Chocante":13,"Uni Cornetto":16.5,
    "M&Ms":16.5,"Brigadeiro Cornetto":16.5,
    "Mini Eski-bon":17,"Mini Morango":17,"Mini Chicabon":17,
    "Mini Doce de Leite":17,"Eski-bon":12,"Brigadeiro":12,
    "Chicabon":12,"Chicabon Menos Açúcar":12,
    "3 Chocolates":12.5,"Max Avelã":12.5,"Tablito":12.5,
    "Expecto":10,"Grifinória":11,"Sonserina":11
};

let categorias = {
    "MAGNUM":["Clássico","Branco","Avelã","Amêndoas","Cookies & Cream","Menos Açúcar","Pistache"],
    "CORNETTO":["Choco Mix","Chocante","Uni Cornetto","M&Ms","Brigadeiro Cornetto"],
    "OS FAVORITOS":["Mini Eski-bon","Mini Morango","Mini Chicabon","Mini Doce de Leite","Eski-bon","Brigadeiro","Chicabon","Chicabon Menos Açúcar","3 Chocolates","Max Avelã","Tablito"],
    "FRUTARE":["Tangerina","Limão","Morango","Abacaxi","Uva","Coco"],
    "FRUTILLY":["Frutilly","Frutilly Pinta Língua"],
    "HARRY POTTER":["Expecto","Grifinória","Sonserina"]
};

let estoque = JSON.parse(localStorage.getItem("estoque")) || {};
let vendido = JSON.parse(localStorage.getItem("vendido")) || {};
let id = 1;

function toggle(c){
    let el=document.getElementById("cat_"+c);
    el.style.display = el.style.display==="block"?"none":"block";
}

function salvar(){
    localStorage.setItem("estoque",JSON.stringify(estoque));
    localStorage.setItem("vendido",JSON.stringify(vendido));
}

function atualizar(i){
    let r=Math.max(0,estoque[i]-vendido[i]);
    document.getElementById("resto_"+i).innerText="Restante: "+r;
    document.getElementById("item_"+i).classList.toggle("zero",r===0);
    salvar();
    recalcular();
}

function add(t,i){
    if(t==="est") estoque[i]++;
    else vendido[i]++;
    document.getElementById(t+"_"+i).innerText = t==="est"?estoque[i]:vendido[i];
    atualizar(i);
}

function remove(t,i){
    if(t==="est" && estoque[i]>0) estoque[i]--;
    if(t==="vend" && vendido[i]>0) vendido[i]--;
    document.getElementById(t+"_"+i).innerText = t==="est"?estoque[i]:vendido[i];
    atualizar(i);
}

function recalcular(){
    let total=0,i=1;
    for(let c in categorias){
        categorias[c].forEach(s=>{
            let p=(c==="FRUTARE"||c==="FRUTILLY")?precoPorCategoria[c]:precosLancamentos[s];
            total+=vendido[i]*p;
            i++;
        });
    }
    document.getElementById("valorTotal").innerText=total.toFixed(2);
}
</script>
</head>

<body>

<h1>Controle de Sorvetes</h1>

<div id="conteudo">
<script>
for(let c in categorias){
document.write(`<button class="cat-btn" onclick="toggle('${c}')">${c}</button><div id="cat_${c}" class="categoria">`);
categorias[c].forEach(s=>{
let p=(c==="FRUTARE"||c==="FRUTILLY")?precoPorCategoria[c]:precosLancamentos[s];
estoque[id]=estoque[id]||0;
vendido[id]=vendido[id]||0;
document.write(`
<div class="item card" id="item_${id}">
<div>
<div class="nome">${s}</div>
<div class="valor">Preço: R$ ${p.toFixed(2)}</div>
<div class="restante" id="resto_${id}"></div>
</div>
<div class="painel">
<div class="controls">
<span>Estoque</span>
<button class="btn" onclick="remove('est',${id})">-</button>
<span class="numero" id="est_${id}">${estoque[id]}</span>
<button class="btn" onclick="add('est',${id})">+</button>
</div>
<div class="controls">
<span>Vendido</span>
<button class="btn" onclick="remove('vend',${id})">-</button>
<span class="numero" id="vend_${id}">${vendido[id]}</span>
<button class="btn" onclick="add('vend',${id})">+</button>
</div>
</div>
</div>`);
setTimeout(()=>atualizar(${id}),0);
id++;
});
document.write("</div>");
}
</script>
</div>

<div id="totalVendas">TOTAL EM VENDAS: R$ <span id="valorTotal">0.00</span></div>

</body>
</html>