<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Pedido de Sorvetes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Ícone para adicionar à Tela Inicial -->
<link rel="apple-touch-icon" href="icone.png">

<style>
    body {
        font-family: -apple-system, Arial, sans-serif;
        background: var(--bg);
        color: var(--txt);
        padding: 12px;
        max-width: 480px;
        margin: auto;
        transition: 0.3s ease;
    }

    /* MODO CLARO */
    :root {
        --bg: #f2f2f7;
        --card: #ffffff;
        --txt: #222;
        --btn-primary: #007aff;
        --btn-danger: #ff3b30;
        --btn-success: #34c759;
        --shadow: rgba(0,0,0,0.12);
    }

    /* MODO ESCURO AUTOMÁTICO */
    @media (prefers-color-scheme: dark) {
        :root {
            --bg: #1c1c1e;
            --card: #2c2c2e;
            --txt: #f2f2f7;
            --shadow: rgba(255,255,255,0.05);
        }
    }

    h1 {
        text-align: center;
        font-size: 26px;
        font-weight: 900;
        margin-bottom: 20px;
    }

    .cat-btn {
        width: 100%;
        background: var(--btn-primary);
        color: white;
        padding: 18px;
        font-size: 20px;
        border: none;
        border-radius: 14px;
        margin-top: 12px;
        cursor: pointer;
        font-weight: bold;
        transition: 0.2s;
    }

    /* Animação da categoria abrindo */
    .categoria {
        display: none;
        background: var(--card);
        padding: 14px;
        border-radius: 14px;
        margin-top: 8px;
        box-shadow: 0 4px 12px var(--shadow);
        overflow: hidden;
        max-height: 0;
        transition: max-height .35s ease;
    }

    .categoria.aberta {
        display: block;
        max-height: 5000px;
    }

    .item {
        background: var(--card);
        padding: 14px;
        margin: 12px 0;
        border-radius: 14px;
        box-shadow: 0 2px 6px var(--shadow);
    }

    .nome {
        font-size: 20px;
        font-weight: bold;
    }

    .valor {
        color: var(--btn-primary);
        font-weight: bold;
        margin-bottom: 8px;
    }

    .controls {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 8px;
    }

    .btn {
        width: 45px;
        height: 45px;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        font-size: 26px;
        font-weight: bold;
    }

    .menos { background: var(--btn-danger); color: white; }
    .mais  { background: var(--btn-success); color: white; }

    .numero {
        width: 45px;
        text-align: center;
        font-size: 22px;
        font-weight: bold;
    }

    /* RESUMO FIXO ESTILO iOS */
    #resumo-box {
        position: sticky;
        bottom: 15px;
        background: var(--card);
        padding: 18px;
        border-radius: 18px;
        box-shadow: 0 8px 20px var(--shadow);
        font-size: 18px;
        font-weight: bold;
        white-space: pre-line;
        backdrop-filter: blur(12px);
    }

    #limpar {
        width: 100%;
        background: var(--btn-danger);
        color: white;
        padding: 18px;
        font-size: 20px;
        border: none;
        border-radius: 14px;
        margin-top: 25px;
        cursor: pointer;
        font-weight: bold;
    }

</style>
</head>
<body>

<h1>Tirar Pedido</h1>
<div id="conteudo"></div>

<!-- RESUMO FIXO -->
<div id="resumo-box">Nenhum item selecionado.</div>

<!-- BOTÃO LIMPAR -->
<button id="limpar" onclick="limparTudo()">LIMPAR</button>

<script>
/* ------------------- PREÇOS ------------------- */
let precoPorCategoria = {
    "PALETAS FRUTIVERÃO": 18,
    "AO LEITE FRUTIVERÃO": 8,
    "TROPICAL FRUTIVERÃO": 6,
    "ESPECIAL FRUTVERÃO": 13,
    "LANÇAMENTOS": null
};

let precosLancamentos = {
    "Pistache": 16,
    "Unicórnio": 10
};

/* ------------------- CATEGORIAS ------------------- */
let categorias = {
    "PALETAS FRUTIVERÃO": [
        "Raffaello","Oreo","Ferrero","Kinder Ovo","Kinder Bueno","M&M","Choco Maltine",
        "Milk Trufado","Babalu","Blue Ice","Sensação","Morango","Maracujá","Açaí",
        "Iogurte c/ Amora","Menta c/ Chocolate","Paçoca","Capuccino","Banana com Avelã",
        "Coco c/ Abobora","Coco c/ Doce de Leite","Tapioca","Abacaxi Zero"
    ],
    "AO LEITE FRUTIVERÃO": [
        "Morango","Chocolate","Leite Condensado","Milho-Verde","Açaí c/ Morango",
        "Coco","Coco Queimado","Abóbora c/ Coco","Amendoim","Abacate","Blue Ice"
    ],
    "TROPICAL FRUTIVERÃO": [
        "Uva","Limão","Maracujá","Manga","Abacaxi","Melancia","Tangerina",
        "Maçã Verde","Groselha","Tutti Frutti","Pinta Língua"
    ],
    "ESPECIAL FRUTVERÃO": [
        "Skimo morango","Skimo ao leite","Milk trufado","Brigadeiro","Chococo",
        "Torta de limão","Itu napolitano","Frutblito","Sunday de chocolate","Sundae de Morango"
    ],
    "LANÇAMENTOS": ["Pistache","Unicórnio"]
};

let vendidoSalvo = JSON.parse(localStorage.getItem("vendido")) || {};
let id = 1;

/* ------------------- GERAR ITENS (DOM) ------------------- */
let container = document.getElementById("conteudo");

for (let cat in categorias) {
    let btn = document.createElement("button");
    btn.className = "cat-btn";
    btn.innerText = cat;
    btn.onclick = () => toggle(cat);
    container.appendChild(btn);

    let box = document.createElement("div");
    box.className = "categoria";
    box.id = "cat_" + cat;

    categorias[cat].forEach(sabor => {
        let item = document.createElement("div");
        item.className = "item";

        let nome = document.createElement("div");
        nome.className = "nome";
        nome.innerText = sabor;

        let preco = (cat === "LANÇAMENTOS") ? precosLancamentos[sabor] : precoPorCategoria[cat];

        let valor = document.createElement("div");
        valor.className = "valor";
        valor.innerText = `Preço: R$ ${preco}`;

        let controls = document.createElement("div");
        controls.className = "controls";

        let menos = document.createElement("button");
        menos.className = "btn menos";
        menos.innerText = "-";
        menos.onclick = () => remove(id);

        let numero = document.createElement("span");
        numero.className = "numero";
        numero.id = "vend_" + id;
        numero.innerText = vendidoSalvo[id] || 0;

        let mais = document.createElement("button");
        mais.className = "btn mais";
        mais.innerText = "+";
        mais.onclick = () => add(id);

        controls.appendChild(menos);
        controls.appendChild(numero);
        controls.appendChild(mais);

        item.appendChild(nome);
        item.appendChild(valor);
        item.appendChild(controls);

        box.appendChild(item);
        id++;
    });

    container.appendChild(box);
}

/* ------------------- FUNÇÕES ------------------- */
function toggle(cat) {
    let box = document.getElementById("cat_" + cat);
    box.classList.toggle("aberta");
}

function add(id) {
    let el = document.getElementById("vend_" + id);
    el.innerText = Number(el.innerText) + 1;
    vendidoSalvo[id] = Number(el.innerText);
    salvar();
    gerarResumo();
}

function remove(id) {
    let el = document.getElementById("vend_" + id);
    if (Number(el.innerText) > 0) el.innerText--;
    vendidoSalvo[id] = Number(el.innerText);
    salvar();
    gerarResumo();
}

function salvar() {
    localStorage.setItem("vendido", JSON.stringify(vendidoSalvo));
}

function gerarResumo() {
    let texto = "";
    let total = 0;
    let i = 1;

    for (let cat in categorias) {
        let blocos = "";

        categorias[cat].forEach(sabor => {
            let q = vendidoSalvo[i] || 0;
            if (q > 0) {
                blocos += `${q} - ${sabor}\n`;
                let preco = (cat === "LANÇAMENTOS") ? precosLancamentos[sabor] : precoPorCategoria[cat];
                total += q * preco;
            }
            i++;
        });

        if (blocos !== "") texto += `${cat}\n${blocos}\n`;
    }

    texto += `TOTAL: R$ ${total.toFixed(2)}`;
    document.getElementById("resumo-box").innerText = texto;
}

function limparTudo() {
    localStorage.clear();
    location.reload();
}

gerarResumo();
</script>

</body>
</html>